{"updatedAt":"2025-12-16T21:40:02.467Z","createdAt":"2025-12-16T11:35:52.289Z","id":"Mq7rfOxMdPuOVFVj","name":"ë©”ì¼ ì „ì†¡","active":false,"isArchived":false,"nodes":[{"parameters":{"url":"http://host.docker.internal:8080/api/v1/subscriptions/active","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"papercore-secret-key-1234"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[208,0],"id":"3ee4d05b-31c0-40c5-a56a-43057e56b279","name":"í™œì„±í™” ìœ ì € ë¦¬ìŠ¤íŠ¸"},{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtDay":[3],"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[0,0],"id":"7174f358-00ab-475c-9950-677ec2b48881","name":"ì£¼ì— 1ë²ˆ"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[416,0],"id":"e30b1265-d35e-4cf8-8497-a6739810fcef","name":"ìœ ì € ë£¨í”„"},{"parameters":{"url":"http://host.docker.internal:8080/api/v1/papers/recommend","sendQuery":true,"queryParameters":{"parameters":[{"name":"email","value":"={{ $json.email }}"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"papercore-secret-key-1234"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[640,0],"id":"337028cb-fa77-49f9-aaf3-f3116102c82b","name":"ì¶”ì²œ ë…¼ë¬¸ ê°€ì ¸ì˜¤ê¸°","alwaysOutputData":true},{"parameters":{"jsCode":"// 1. ê°€ì¥ ìµœì‹ (ì²« ë²ˆì§¸) ë…¼ë¬¸ ê°€ì ¸ì˜¤ê¸°\nconst papers = $input.all().map(i => i.json);\n\nif (papers.length === 0) {\n    // ì¶”ì²œ ë…¼ë¬¸ì´ ì—†ì„ ê²½ìš° (ì—ëŸ¬ ë°©ì§€)\n    return []; \n}\n\nconst topPaper = papers[0];\nlet htmlBody = topPaper.deepDiveAnalysis;\n\n// 2. ë§Œì•½ ìˆ˜ì§‘ ë‹¨ê³„ ì˜¤ë¥˜ë¡œ ë¶„ì„ ë°ì´í„°ê°€ ì—†ë‹¤ë©´? (ì•ˆì „ì¥ì¹˜)\nif (!htmlBody) {\n    htmlBody = `\n        <h3>âš ï¸ ìƒì„¸ ë¶„ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.</h3>\n        <p>ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ ì´ ë…¼ë¬¸ì˜ ìƒì„¸ ë¶„ì„ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>\n        <p><strong>ìš”ì•½:</strong> ${topPaper.summary}</p>\n        <a href=\"${topPaper.pdfUrl}\">PDF ì›ë¬¸ ë³´ê¸°</a>\n    `;\n}\n\n// 3. ë‹¤ìŒ ë…¸ë“œë¡œ ë°ì´í„° ë„˜ê¸°ê¸°\nreturn {\n    json: {\n        email: $('ìœ ì € ë£¨í”„').first().json.email, // ìœ ì € ì´ë©”ì¼ ìœ ì§€\n        title: topPaper.title,\n        html: htmlBody,         // DBì—ì„œ êº¼ë‚¸ ê³ í€„ë¦¬í‹° HTML\n        paperId: [topPaper.id]    // ë¡œê·¸ ì €ì¥ìš© ID\n    }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1440,160],"id":"ca93ca39-10e3-47fd-b767-1b724d0fa804","name":"ìƒì„¸ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°"},{"parameters":{"jsCode":"// 1. ì…ë ¥ ë°ì´í„°(ë…¼ë¬¸ ë¦¬ìŠ¤íŠ¸) ê°€ì ¸ì˜¤ê¸°\nconst papers = $input.all().map(item => item.json);\n\n// 2. ìœ ì € ì´ë©”ì¼ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° \n// (ì£¼ì˜: 'Split In Batches' ë…¸ë“œ ì´ë¦„ì´ ë‹¤ë¥´ë©´ ìˆ˜ì • í•„ìš”)\nlet userEmail = \"subscriber@example.com\"; \ntry {\n    userEmail = $('ìœ ì € ë£¨í”„').first().json.email;\n} catch (e) {\n    // í…ŒìŠ¤íŠ¸ ì‹œ ì—ëŸ¬ ë°©ì§€ìš© (ì‹¤ì œ ì‹¤í–‰ ì‹œì—” ìœ„ ì½”ë“œê°€ ì‘ë™í•¨)\n    console.log(\"Email not found from previous node, using default.\");\n}\n\n// 3. HTML í—¤ë” ì‘ì„± (ì• í”Œ ìŠ¤íƒ€ì¼ì˜ ê¹”ë”í•œ ë””ìì¸)\nlet htmlContent = `\n  <div style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #333; line-height: 1.6;\">\n    <div style=\"padding: 20px 0; border-bottom: 1px solid #eee; margin-bottom: 20px;\">\n        <h2 style=\"margin: 0; color: #111; font-weight: 700;\">ğŸ“¬ Papercore Daily</h2>\n        <p style=\"margin: 5px 0 0; color: #666; font-size: 14px;\">${userEmail}ë‹˜ì„ ìœ„í•œ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë…¼ë¬¸ì…ë‹ˆë‹¤.</p>\n    </div>\n`;\n\n// 4. ê° ë…¼ë¬¸ì„ ì¹´ë“œ í˜•íƒœë¡œ ë³€í™˜\npapers.forEach(paper => {\n    // ì¹´í…Œê³ ë¦¬ íƒœê·¸ ìƒì„± (ìµœëŒ€ 3ê°œ)\n    const tags = paper.categories ? paper.categories.slice(0, 3).map(c => \n        `<span style=\"background: #EBF5FF; color: #2563EB; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 500; margin-right: 6px;\">#${c}</span>`\n    ).join('') : '';\n\n    // ì €ì ëª©ë¡ (ìµœëŒ€ 3ëª… + et al.)\n    let authors = \"Unknown Authors\";\n    if (paper.authors && paper.authors.length > 0) {\n        authors = paper.authors.slice(0, 3).join(\", \");\n        if (paper.authors.length > 3) authors += \" et al.\";\n    }\n\n    htmlContent += `\n    <div style=\"margin-bottom: 30px; padding: 20px; background: #fafafa; border-radius: 12px; border: 1px solid #eee;\">\n        <div style=\"margin-bottom: 10px;\">${tags}</div>\n        <h3 style=\"margin: 0 0 10px 0; font-size: 18px; line-height: 1.4;\">\n            <a href=\"${paper.arxivId}\" style=\"text-decoration: none; color: #111; hover:text-decoration: underline;\">${paper.title}</a>\n        </h3>\n        <p style=\"margin: 0 0 15px 0; font-size: 13px; color: #888;\">âœï¸ ${authors}</p>\n        \n        <div style=\"background: #fff; padding: 15px; border-radius: 8px; border-left: 3px solid #2563EB;\">\n            <p style=\"margin: 0; font-size: 14px; color: #444;\">${paper.summary}</p>\n        </div>\n        \n        <div style=\"margin-top: 15px; text-align: right;\">\n             <a href=\"${paper.arxivId}\" style=\"font-size: 13px; color: #2563EB; text-decoration: none; font-weight: 600;\">ì›ë¬¸ ë³´ê¸° â†’</a>\n        </div>\n    </div>\n    `;\n});\n\n// 5. HTML í‘¸í„° ì‘ì„±\nhtmlContent += `\n    <div style=\"border-top: 1px solid #eee; padding-top: 20px; text-align: center; color: #999; font-size: 12px;\">\n        <p>Papercore AI Research Assistant</p>\n        <p>ë” ì´ìƒ ì´ ë©”ì¼ì„ ë°›ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ <a href=\"#\" style=\"color: #999;\">êµ¬ë… ì·¨ì†Œ</a>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>\n    </div>\n  </div>\n`;\n\n// 6. ê²°ê³¼ ë°˜í™˜ (ì´ë©”ì¼ ë…¸ë“œì™€ ë¡œê·¸ ë…¸ë“œì—ì„œ ì“¸ ë°ì´í„°)\nreturn {\n    json: {\n        email: userEmail,\n        html: htmlContent,\n        sentPaperIds: papers.map(p => p.id), // ë¡œê·¸ ì €ì¥ìš© ID ë¦¬ìŠ¤íŠ¸\n        paperCount: papers.length\n    }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1440,384],"id":"b46631e6-a254-4ded-8d19-8ad02b1ffe4a","name":"ìš”ì•½ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°"},{"parameters":{"sendTo":"={{ $json.email }}","subject":"=[Papercore] ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë…¼ë¬¸ {{$json.paperCount}}í¸ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤ ğŸ“š","message":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1664,384],"id":"4ef37178-c9ac-4051-8511-2254bf903cd0","name":"ìš”ì•½ ë©”ì¼ ì „ì†¡","webhookId":"6c9d1b18-7213-4b98-aef1-cb12ca94fb77","credentials":{"gmailOAuth2":{"id":"JvQumY2xKg6PzkX3","name":"Gmail account"}}},{"parameters":{"sendTo":"={{ $json.email }}","subject":"=[Papercore] ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë…¼ë¬¸ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤ ğŸ“š","message":"={{ $json.html }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1664,160],"id":"6f0ffb5c-9d7d-418e-a636-51b86eceebed","name":"ìƒì„¸ ë©”ì¼ ì „ì†¡","webhookId":"6c9d1b18-7213-4b98-aef1-cb12ca94fb77","credentials":{"gmailOAuth2":{"id":"JvQumY2xKg6PzkX3","name":"Gmail account"}}},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/api/v1/logs","sendBody":true,"bodyParameters":{"parameters":[{"name":"email","value":"={{ $('ìš”ì•½ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°').item.json.email }}"},{"name":"paperIds","value":"={{ $('ìš”ì•½ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°').item.json.sentPaperIds }}"},{"name":"status","value":"SUCCESS"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1840,384],"id":"d8164cf1-650d-4410-8ac4-548cd3b4dd1b","name":"ìš”ì•½ ë¡œê·¸ ì €ì¥"},{"parameters":{"method":"POST","url":"http://host.docker.internal:8080/api/v1/logs","sendBody":true,"bodyParameters":{"parameters":[{"name":"email","value":"={{ $('ìƒì„¸ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°').item.json.email }}"},{"name":"paperIds","value":"={{ $('ìƒì„¸ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°').item.json.paperId }}"},{"name":"status","value":"SUCCESS"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[1840,160],"id":"eb900d27-2f70-4392-b3fd-4d4ecbbda827","name":"ìƒì„¸ ë¡œê·¸ ì €ì¥"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"67c8bc59-6749-4821-880d-4606a41ba9ae","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[864,0],"id":"e6f82842-bd3c-46f8-93cc-2b2158acf2c7","name":"ì¶”ì²œ ë…¼ë¬¸ ì¡´ì¬"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"leftValue":"={{ $('ìœ ì € ë£¨í”„').item.json.preferences.type }}","rightValue":"premium","operator":{"type":"string","operation":"equals"},"id":"6f101e2b-6cf5-4252-818c-e03db5f80b38"}],"combinator":"and"},"renameOutput":true,"outputKey":"premium"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"57303564-68a2-4f44-aa39-b1cd20ad2b78","leftValue":"=","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"basic"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.4,"position":[1136,0],"id":"b551dbea-54ea-4048-851c-e41529bffc90","name":"basic vs premium"}],"connections":{"í™œì„±í™” ìœ ì € ë¦¬ìŠ¤íŠ¸":{"main":[[{"node":"ìœ ì € ë£¨í”„","type":"main","index":0}]]},"ì£¼ì— 1ë²ˆ":{"main":[[{"node":"í™œì„±í™” ìœ ì € ë¦¬ìŠ¤íŠ¸","type":"main","index":0}]]},"ìœ ì € ë£¨í”„":{"main":[[],[{"node":"ì¶”ì²œ ë…¼ë¬¸ ê°€ì ¸ì˜¤ê¸°","type":"main","index":0}]]},"ì¶”ì²œ ë…¼ë¬¸ ê°€ì ¸ì˜¤ê¸°":{"main":[[{"node":"ì¶”ì²œ ë…¼ë¬¸ ì¡´ì¬","type":"main","index":0}]]},"ìƒì„¸ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°":{"main":[[{"node":"ìƒì„¸ ë©”ì¼ ì „ì†¡","type":"main","index":0}]]},"ìš”ì•½ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°":{"main":[[{"node":"ìš”ì•½ ë©”ì¼ ì „ì†¡","type":"main","index":0}]]},"ìš”ì•½ ë©”ì¼ ì „ì†¡":{"main":[[{"node":"ìš”ì•½ ë¡œê·¸ ì €ì¥","type":"main","index":0}]]},"ìƒì„¸ ë©”ì¼ ì „ì†¡":{"main":[[{"node":"ìƒì„¸ ë¡œê·¸ ì €ì¥","type":"main","index":0}]]},"ìš”ì•½ ë¡œê·¸ ì €ì¥":{"main":[[{"node":"ìœ ì € ë£¨í”„","type":"main","index":0}]]},"ìƒì„¸ ë¡œê·¸ ì €ì¥":{"main":[[{"node":"ìœ ì € ë£¨í”„","type":"main","index":0}]]},"ì¶”ì²œ ë…¼ë¬¸ ì¡´ì¬":{"main":[[{"node":"basic vs premium","type":"main","index":0}],[{"node":"ìœ ì € ë£¨í”„","type":"main","index":0}]]},"basic vs premium":{"main":[[{"node":"ìƒì„¸ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°","type":"main","index":0}],[{"node":"ìš”ì•½ ë…¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸°","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"eaf26948-d8c7-4e78-bbc9-5ca346a47aad","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-16T11:35:52.291Z","createdAt":"2025-12-16T11:35:52.291Z","role":"workflow:owner","workflowId":"Mq7rfOxMdPuOVFVj","projectId":"eOLlyeWyG1vSm2sy"}],"activeVersion":null,"tags":[]}